EasyBlog.module("media/place",function(e){var t=this;EasyBlog.Controller("Media.Place",{defaultOptions:{initialPlace:"",places:[],"{placeMenuGroup}":".placeMenuGroup","{placeMenu}":".placeMenu","{placeBodyGroup}":".placeBodyGroup","{placeBody}":".placeBody",view:{placeMenu:"media/place.menu",placeBody:"media/place.body"}}},function(t){return{init:function(){e.each(t.options.places,function(e,n){t.addPlace(n)}),t.setLayout()},setLayout:function(){t.currentPlace&&t.currentPlace.setLayout&&t.currentPlace.setLayout()},places:{},loadPlace:function(e,t){var n=EasyBlog.require().script("media/place."+e.toLowerCase()).done(t);return n},addPlace:function(n){var r=n.name,i=n.title,s=t.view.placeMenu({title:i}).addClass(n.name).appendTo(t.placeMenuGroup()),o=t.view.placeBody().addClass(n.name).appendTo(t.placeBodyGroup()),u=n.options,a=u?u.id:r,f=function(){var n=EasyBlog.Controller.Media.Place[r],f=new n(t.element,e.extend({controller:{id:a,media:t.media,name:r,title:i,menu:s,body:o}},u));f.menu.data("place",f),f.body.data("place",f),t.places[a]=f,f.name===t.options.initialPlace&&t.togglePlace(f,!0)},l=EasyBlog.Controller.Media.Place[r];return l==undefined?t.loadPlace(r,f):f(),n},getPlace:function(e){return t.places[e]},activate:function(e){t.togglePlace(e,!0)},deactivate:function(e){if(t.currentPlace!==e)return;t.togglePlace(e)},togglePlace:function(n,r){if(n===undefined)return;var i=t.currentPlace,s=n,o=!0;i==s&&!r&&(s=undefined);if(i&&i!=s){e.isFunction(i.onPlaceLeave)&&(o=i.onPlaceLeave(s)!==!1);if(!o)return;i.menu.add(i.body).removeClass("active")}t.currentPlace=s,s&&(s.menu.add(s.body).addClass("active"),t.setLayout(),e.isFunction(s.onPlaceEnter)&&s.onPlaceEnter(i))},"{placeMenu} click":function(e){var n=e.data("place");if(n!==undefined){if(n===t.currentPlace)return;t.togglePlace(n)}}}}),t.resolve()});